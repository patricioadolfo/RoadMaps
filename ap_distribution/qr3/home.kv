<BranchCard>
    
    orientation: 'vertical'
    style: 'elevated'
    padding: '5dp'
    pos_hint: {'center_x': .5, 'center_y': .5}
    size_hint_y: .9
    size_hint_x: .9
    MDBoxLayout:
        orientation: 'horizontal'
        pos_hint: {'center_x': .5, 'center_y': .9}
        padding:10
        size_hint_y: .1
        MDLabel:
            id: branch_card_lb
            text: '' 
            font_style: "Title"
            color: '#1f91dc'
            bold: True       
            pos_hint: {'center_x': .2, 'center_y': .5}
        MDIconButton:
            icon: 'close' 
            pos_hint: {'center_x': .9, 'center_y': .5}
            on_press: root.close_card()
    MDTabsSecondary:
        id: tabs
        pos_hint: {"center_x": .5, "center_y": .8}
        size_hint_y: .9

        MDDivider:

        MDTabsItem:
            MDTabsItemText:
                text: 'Retirar'
        
        MDTabsItem:
            MDTabsItemText:
                text: 'Entregar'
         
        MDTabsCarousel:
            size_hint_y: None
            height: dp(320)
            
            MDScrollView:
                size_hint_y: .9
                MDList:
                    id: card_branch_p

            MDScrollView:
                size_hint_y: .9
                MDList:
                    id: card_branch_c
        

<Branch>
    name: 'Sucursales'
    MDScrollView:

        MDList:
            id: mdlist

<QrCard>

    orientation: 'vertical'
    style: 'elevated'
    padding: '5dp'
    size_hint: None, None
    pos_hint: {'center_x': .5, 'center_y': .5}
    size: ("300dp", "250dp")
    ripple_behavior: True

    MDBoxLayout:
        id: box_card
        orientation: 'horizontal'
        pos_hint: {'center_x': .5, 'center_y': 1}
        padding:10
        size_hint_y: .2
        MDLabel:
            id: lb_box_card
            text: 'Qr' 
            font_style: "Title"
            color: '#1f91dc'
            bold: True       
            pos_hint: {'center_x': .2, 'center_y': .5}
        MDIconButton:
            icon: 'close' 
            pos_hint: {'center_x': .9, 'center_y': .5}
            on_press: root.close_card()

    MDBoxLayout:
        id: box_qr_card
        size_hint_y: .8
        md_bg_color: '#1f91dc'
        orientation: 'vertical'
        padding: '15dp'
        radius: dp(15)
        MDLabel:
            id: lb_box_card
            text: ''
            color:  app.theme_cls.backgroundColor
            adaptive_size: True
            bold: True 
            pos_hint: {'center_x': .5, 'center_y': 1}
            

<Login>

    MDLabel:
        text: "Login"
        bold: True
        font_style: "Title"
        halign: "center"
        pos_hint: {'center_y': .9}
    
    MDTextField:
        id: username
        color_mode: 'Primary'
        hint_text: "Username"
        icon_left: "account"
        font_size: "20dp"
        size_hint_x: .7
        pos_hint: {'center_x': .5, 'center_y': .8}
        on_text: self.text = self.text.replace(" ", "")
        write_tab: False

    MDTextField:
        id: password
        color_mode: 'primary'
        hint_text: "Password"
        password: True
        icon: 'eye-off'
        font_size: "20dp"
        size_hint_x: .7
        pos_hint: {'center_x': .5, 'center_y': .65}
        on_text: self.text = self.text.replace(" ", "")
        write_tab: False
    
    MDBoxLayout: 
        size_hint: .65, None
        height: "30dp"
        pos_hint: {'center_x': .5, 'center_y': .55}
        spacing: '5dp'

        MDCheckbox:
            id: cb
            size_hint: None, None
            width: "30dp"
            height: "30dp"
            pos_hint: {'center_x': .5, 'center_y': .5}
            on_press: 
                password.password = False  if password.password == True else True
                password.icon_right = "eye" if password.icon_right == "eye-off" else "eye-off"

        MDLabel:
            text: "[ref=Show Password]Show Password[/ref]"
            markup: True
            pos_hint: {'center_x': .5, 'center_y': .5}
            on_ref_press:
                cb.active = False if cb.active == True else True
                password.password = False  if password.password == True else True
    
    MDBoxLayout: 
        size_hint: .7, None
        height: "30dp"
        pos_hint: {'center_x': .5, 'center_y': .4}
        spacing: '15dp'
        MDTextField:
            id: url
            hint_text: "Direccion"
            icon_right: "account"
            font_size: "20dp"
            size_hint_x: .95
            on_text: self.text = self.text.replace(" ", "")
            write_tab: False

        MDIconButton:
            icon: "login"
            size_hint: None, None
            size: "60dp", "60dp"
            halign: "center"
            on_release:
                root.manager.transition.direction = "up"
                root.login(url, username, password, app.user)

<BaseMDNavigationItem>

    MDNavigationItemIcon:
        icon: root.icon

    MDNavigationItemLabel:
        text: root.text


<BaseScreen>


MDBoxLayout:
    orientation: "vertical"
    md_bg_color: app.theme_cls.backgroundColor
    padding:5 
    

    MDBoxLayout:
        id: box_header
        md_bg_color: '#1f91dc'
        pos_hint: {'center_x': .5, 'center_y': 0.8}
        size_hint_y: .1
        orientation: 'horizontal'
        padding:10   
  

        MDLabel:
            text: 'Hoja de Ruta' 
            font_style: "Title"
            bold: True
            color:  app.theme_cls.backgroundColor      
            pos_hint: {'center_x': .2, 'center_y': .5}
        
        MDIconButton:
            id: btn_log
            icon: "account"
            color: app.theme_cls.backgroundColor
            pos_hint: {'center_x': .4, 'center_y': .5}
            on_press: 
                root.ids.screen_manager.current= 'login' if self.icon == "account"  else screenlogin.logout(app.user, home_btn, qr_btn, branch_btn, self)


    MDScreenManager:
        id: screen_manager

        Login:
            id: screenlogin
            name: 'login'

        BaseScreen:
            name: "Home"
            id: box_home

        BaseScreen:
            name: "Qr-Scan"
            id: box_body

        Branch:
            id: screen_branch
            name: 'Sucursales'

    MDNavigationBar:
        on_switch_tabs: app.on_switch_tabs(*args)
        md_bg_color: '#7792C4'
        radius: dp(24)

        BaseMDNavigationItem
            id: home_btn
            icon: "home"
            text: "Home"
            disabled: True
            on_press: app.cam.close_cam(box_body)

        BaseMDNavigationItem
            id: qr_btn
            icon: "qrcode-scan"
            text: "Qr-Scan"
            disabled: True
            on_press: app.cam.run(box_body)

        BaseMDNavigationItem
            id: branch_btn
            icon: "map-marker-radius-outline"
            text: "Sucursales"
            disabled: True
            on_press: 
                app.cam.close_cam(box_body)
                root.ids.screen_manager.current= 'Sucursales'
                app.branch.branch_nodes(screen_branch)
            


